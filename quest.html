<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Quest Begins</title>
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; }
    #message {
      position:absolute; top:0; left:0; width:100vw; height:100vh;
      display:flex; align-items:center; justify-content:center;
      color:#fff; font:32px sans-serif; text-transform:uppercase; z-index:2;
    }
    #gameCanvas {
      position:absolute; top:0; left:0; display:none;
      width:100vw; height:100vh; background:#334455; z-index:1;
    }
  </style>
</head>
<body>
  <div id="message">YOUR QUEST BEGINS</div>
  <canvas id="gameCanvas"></canvas>

  <script>
  // retrieve hero or bounce back
  const hero = sessionStorage.getItem("selectedHero");
  if (!hero) {
    window.location.href = "index.html";
    throw "No hero selected";
  }
  console.log("Hero:", hero);

  // sprite and canvas setup
  const FRAME_W=16, FRAME_H=16, SCALE=3;
  const ROW_DOWN=0, ROW_UP=1, ROW_LEFT=2, ROW_RIGHT=3;
  const canvas=document.getElementById("gameCanvas"),
        ctx=canvas.getContext("2d"),
        img=new Image();
  img.src="sprites/characters/sprite.png";

  // state
  let x,y, dir=ROW_DOWN, frame=0, timer=0, keys={};

  // resize to fill
  function resize(){
    canvas.width=innerWidth; canvas.height=innerHeight;
    x=canvas.width/2; y=canvas.height/2;
  }
  window.addEventListener("resize",resize);

  // on image load, wait 3s then start
  img.onload = ()=>{
    resize();
    setTimeout(()=>{
      document.getElementById("message").style.display="none";
      canvas.style.display="block";
      requestAnimationFrame(loop);
    },3000);
  };

  // input
  addEventListener("keydown",e=>{
    if(e.key.startsWith("Arrow")){keys[e.key]=1; e.preventDefault();}
  });
  addEventListener("keyup",e=>{
    if(e.key.startsWith("Arrow")){delete keys[e.key]; e.preventDefault();}
  });

  function update(){
    const speed=4; let moving=false;
    if(keys["ArrowUp"]){ y-=speed; dir=ROW_UP; moving=true; }
    else if(keys["ArrowDown"]){ y+=speed; dir=ROW_DOWN; moving=true; }
    else if(keys["ArrowLeft"]){ x-=speed; dir=ROW_LEFT; moving=true; }
    else if(keys["ArrowRight"]){ x+=speed; dir=ROW_RIGHT; moving=true; }

    if(moving){
      timer++; if(timer>6){ frame=(frame+1)%4; timer=0; }
    } else { frame=0; timer=0; }

    // clamp
    x=Math.max(FRAME_W*SCALE/2,Math.min(canvas.width-FRAME_W*SCALE/2,x));
    y=Math.max(FRAME_H*SCALE/2,Math.min(canvas.height-FRAME_H*SCALE/2,y));
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(
      img,
      frame*FRAME_W, dir*FRAME_H, FRAME_W, FRAME_H,
      x-FRAME_W*SCALE/2, y-FRAME_H*SCALE/2,
      FRAME_W*SCALE, FRAME_H*SCALE
    );
  }

  function loop(){
    update(); draw(); requestAnimationFrame(loop);
  }
  </script>
</body>
</html>
