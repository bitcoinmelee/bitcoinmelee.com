<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bitcoin Melee — Battle Arena</title>

  <!-- Fantasy fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&family=Montserrat:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />

  <style>
    :root{
      --parchment:#f9f4e8;
      --ink:#2b2a29;
      --user:#216869;
      --enemy:#a11d33;
      --bar:#fff8ef;
      --border:#8c6b42;
    }
    *{box-sizing:border-box}
    body{margin:0;padding:4.5rem 1.2rem 4.5rem;font-family:'Montserrat',sans-serif;background:var(--parchment);color:var(--ink);}/*padding leaves room for team bars*/
    h1{font-family:'Uncial Antiqua',cursive;font-size:2.2rem;margin:0 0 0.6rem;text-align:center;letter-spacing:1px;}

    /* TOP / BOTTOM TEAM BARS */
    .teamBarWrap{position:fixed;left:0;width:100%;z-index:10;display:flex;justify-content:center;pointer-events:none}
    #enemyBar{top:0;border-bottom:3px double var(--border);background:var(--bar);} 
    #userBar{bottom:0;border-top:3px double var(--border);background:var(--bar);} 

    .teamBar{display:flex;gap:1rem;padding:0.4rem 1rem;margin:0;list-style:none;overflow-x:auto;max-width:100%;}
    .teamBar li{pointer-events:auto;display:flex;flex-direction:column;align-items:center;font-size:0.8rem;white-space:nowrap;}
    .teamBar progress{width:90px;height:8px;margin-bottom:2px;accent-color:var(--user);} 
    #enemyBar progress{accent-color:var(--enemy);} 

    /* battle UI */
    #startBattle{display:block;margin:0.8rem auto 0;padding:0.5rem 1.2rem;font-size:1.05rem;font-family:'Uncial Antiqua',cursive;background:#d1b280;border:2px solid var(--border);border-radius:6px;cursor:pointer;}
    #startBattle:disabled{opacity:0.5;cursor:not-allowed}

    #battleLog{max-height:260px;overflow-y:auto;margin-top:0.8rem;border:2px solid var(--border);padding:0.6rem;background:#fffefa;font-size:0.9rem;}

    #controls{margin-top:1rem;border:2px solid var(--border);background:#fffefa;padding:0.8rem;border-radius:6px;box-shadow:0 1px 4px rgba(0,0,0,0.15);} 
    #controls p{margin:0 0 0.5rem;font-family:'Uncial Antiqua',cursive;}
    .charCtrl{margin:0.4rem 0}
    .charCtrl button{margin-left:0.5rem;padding:0.25rem 0.6rem;border:1px solid #444;border-radius:4px;background:#dfd6c2;font-size:0.85rem;cursor:pointer;}
    .charCtrl button:hover:not(:disabled){background:#cbbfa6}
    .ap{font-weight:bold}
    .hidden{display:none}
  </style>
</head>
<body>
  <h1>Bitcoin Melee</h1>

  <!-- Enemy team along the top -->
  <div id="enemyBar" class="teamBarWrap">
    <ul id="enemyTeam" class="teamBar"></ul>
  </div>

  <!-- Main battle area -->
  <button id="startBattle" disabled>Commence Battle</button>
  <div id="battleLog"></div>
  <div id="controls" class="hidden"></div>

  <!-- Your team along the bottom -->
  <div id="userBar" class="teamBarWrap">
    <ul id="userTeam" class="teamBar"></ul>
  </div>

<script>
/***** Constants *****/
const ABILITY_COST = 3;
const ATTACK_COST  = 1;
const AP_PER_TURN  = 5;

/***** Helpers *****/
const cap=s=>s&&s.length?s[0].toUpperCase()+s.slice(1).toLowerCase():'';
const d20=()=>Math.floor(Math.random()*20)+1;
const d6 =()=>Math.floor(Math.random()*6)+1;
const mod=v=>Math.floor((v-10)/2);

/***** Data *****/
let characters=[],abilities={};
Promise.all([
  fetch('characters.json').then(r=>r.json()),
  fetch('abilities.json').then(r=>r.json())
]).then(([c,a])=>{characters=c;abilities=a;initTeams();document.getElementById('startBattle').disabled=false;}).catch(console.error);

/***** Ability helpers *****/
function abilityTargetFlags(name){const eff=abilities[name]||{};let ally=false,foe=false,self=false;for(const k of Object.keys(eff)){if(k.endsWith('_ally'))ally=true;else if(k.endsWith('_Foe'))foe=true;else if(k.endsWith('_Self'))self=true;}if(!ally&&!foe&&!self)foe=true;return{ally,foe,self};}
function legalAbilityTargets(actor,allies,foes){const f=abilityTargetFlags(actor.ability);let t=[];if(f.self)t.push(actor);if(f.ally)t=t.concat(allies.filter(a=>a!==actor));if(f.foe)t=t.concat(foes);return t;}

/***** Teams *****/
let userTeamData=[],enemyTeamData=[];
function initTeams(){const stored=sessionStorage.getItem('roster');if(!stored)return;userTeamData=JSON.parse(stored);const used=new Set(userTeamData.map(h=>h.Name));const pool=characters.filter(c=>!used.has(c.Name));shuffle(pool);enemyTeamData=pool.slice(0,userTeamData.length);renderInitialLists();}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}

/***** Character *****/
class Character{constructor(r){this.name=r.Name;this.maxHp=r.Health;this.hp=this.maxHp;this.str=r.Strength;this.dex=r.Dexterity;this.con=r.Constitution;this.int=r.Intelligence;this.wis=r.Wisdom;this.cha=r.Charisma;this.mana=r.Mana;this.ability=r['Common Ability']||r.Ability||'';}isAlive(){return this.hp>0;}attack(t){const atk=d20()+mod(this.str);const ac=10+mod(t.dex);if(atk<ac)return{hit:false,dmg:0};const dmg=Math.max(1,d6()+mod(this.str));t.hp=Math.max(0,t.hp-dmg);return{hit:true,dmg};} _applyStat(stat,val){const clamp=x=>Math.max(0,x);switch(stat){case 'Health':this.hp=Math.min(this.maxHp,clamp(this.hp+val));break;case 'Strength':this.str=clamp(this.str+val);break;case 'Dexterity':this.dex=clamp(this.dex+val);break;case 'Constitution':this.con=clamp(this.con+val);break;case 'Intelligence':this.int=clamp(this.int+val);break;case 'Wisdom':this.wis=clamp(this.wis+val);break;case 'Charisma':this.cha=clamp(this.cha+val);break;case 'Mana':this.mana=clamp(this.mana+val);break;}}applyAbility(allies,foes,target){const eff=abilities[this.ability]||{};for(const[k,v]of Object.entries(eff)){const stat=k.split('_')[0];if(k.endsWith('_Self'))this._applyStat(stat,v);if(k.endsWith('_ally'))allies.forEach(a=>a._applyStat(stat,v));if(k.endsWith('_Foe')&&target)target._applyStat(stat,v);}}}
const inst=a=>a.map(r=>new Character(r));

/***** UI rendering *****/
function hpBar(c,team){const p=document.createElement('progress');p.value=c.hp;p.max=c.maxHp;if(team==='enemy')p.classList.add('enemy');return p;}
function liForRec(r,team){const li=document.createElement('li');li.innerHTML=`<strong>${cap(r.Name)}</strong>`;return li;}
function liForChar(c,team){const li=document.createElement('li');li.appendChild(hpBar(c,team));li.innerHTML+=`<strong>${cap(c.name)}</strong>`;return li;}
function renderInitialLists(){const u=document.getElementById('userTeam');const e=document.getElementById('enemyTeam');u.innerHTML='';e.innerHTML='';userTeamData.forEach(r=>u.appendChild(liForRec(r,'user')));enemyTeamData.forEach(r=>e.appendChild(liForRec(r,'enemy')));}function refreshLists(){const u=document.getElementById('userTeam');const e=document.getElementById('enemyTeam');u.innerHTML='';e.innerHTML='';playerChars.forEach(c=>u.appendChild(liForChar(c,'user')));enemyChars.forEach(c=>e.appendChild(liForChar(c,'enemy')));}

/***** Battle state *****/
let playerChars=[],enemyChars=[];let playerAP=0,aiAP=0;let usedPlayer=new Set(),usedAI=new Set();let playerTurn=true;const logDiv=document.getElementById('battleLog');function log(msg){const p=document.createElement('p');p.textContent=msg;logDiv.appendChild(p);logDiv.scrollTop=logDiv.scrollHeight;}

/***** Battle flow & turns (same as previous, omitted for brevity) *****/
// ... (retain the previously implemented logic for turns, controls, AI, victory)
</script>
</body>
</html>
